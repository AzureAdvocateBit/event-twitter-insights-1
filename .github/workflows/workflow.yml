on:
  push:
    branches:
      - master

name: Build and deploy queue function

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # checkout the repo
      - uses: actions/checkout@master

      - name: "Run npm"
        shell: bash
        working-directory: backend
        run: |
          # If your function app project is not located in your repository's root
          # Please change your directory for npm in pushd
          pushd .
          npm install
          npm run build --if-present
          npm run test --if-present
          popd

      # deploy web app using publish profile credentials
      - name: "Run Azure Functions Action"
        uses: Azure/functions-action@v1
        with:
          app-name: aapowellpowerfuldev-backend-backup
          package: ./backend
          publish-profile: ${{ secrets.AZURE_CREDENTIALS_88292C7B }}
